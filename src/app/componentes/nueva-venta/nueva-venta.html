<div class="nueva-venta-layout">
  <h2 class="titulo">ğŸ›’ Nueva Venta</h2>

  <div class="filtros">
    <div class="campo">
      <label>ğŸ” Buscar (tipo/marca/nombre):</label>
      <input type="text"
             [(ngModel)]="filtroTexto"
             placeholder="Ej: Whisky o Johnnie Walker"
             (keydown)="soloLetras($event)"
             (ngModelChange)="validarBuscar()">
      <div class="error" *ngIf="errorBuscar">{{ errorBuscar }}</div>
    </div>

    <div class="campo">
      <label>ğŸ’µ Precio mÃ­nimo:</label>
      <input type="number" [(ngModel)]="precioMin">
    </div>

    <div class="campo">
      <label>ğŸ’° Precio mÃ¡ximo:</label>
      <input type="number" [(ngModel)]="precioMax">
    </div>
  </div>

  <div class="productos-grid">
    <div class="producto-card"
         *ngFor="let producto of productos | filtroTipo:filtroTexto:precioMin:precioMax">
      <h3>{{ producto.nombre }}</h3>
      <p>{{ producto.descripcion }}</p>
      <p>ğŸ’µ Precio: S/. {{ producto.precio }}</p>
      <p>ğŸ“¦ Stock: {{ producto.stock }}</p>
      <p>ğŸ·ï¸ Tipo: {{ producto.tipoProductoNombre }}</p>
      <p>ğŸ­ Marca: {{ producto.marcaNombre }}</p>
      <button (click)="agregarProducto(producto)">â• AÃ±adir</button>
    </div>
  </div>

  <div class="carrito" *ngIf="carrito.length > 0">
    <h3>ğŸ›ï¸ Carrito</h3>
    <table>
      <thead>
        <tr>
          <th>Producto</th>
          <th>Cantidad</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of carrito">
          <td>{{ item.producto.nombre }}</td>
          <td>{{ item.cantidad }}</td>
          <td>S/. {{ item.cantidad * item.precioUnitario }}</td>
        </tr>
      </tbody>
    </table>

    <div class="total">
      <p>ğŸ’³ Total: <strong>S/. {{ calcularTotal() }}</strong></p>
    </div>

    <div class="comprobante">
      <label>ğŸ§¾ Tipo Comprobante:</label>
      <select [(ngModel)]="tipoComprobante" (change)="validarDocumento()">
        <option value="Boleta">Boleta</option>
        <option value="Factura">Factura</option>
      </select>

      <label *ngIf="tipoComprobante === 'Boleta'">ğŸ”¢ DNI Cliente:</label>
      <label *ngIf="tipoComprobante === 'Factura'">ğŸ”¢ RUC Cliente:</label>
      <input type="text"
             [(ngModel)]="documentoCliente"
             [placeholder]="tipoComprobante === 'Boleta' ? 'Ingrese DNI' : 'Ingrese RUC'"
             [attr.maxlength]="tipoComprobante === 'Boleta' ? 8 : 15"
             inputmode="numeric"
             (keydown)="soloNumeros($event)"
             (ngModelChange)="validarDocumento()">
      <div class="error" *ngIf="errorDocumento">{{ errorDocumento }}</div>
    </div>

    <div class="metodo-pago">
      <label>ğŸ’³ MÃ©todo de Pago:</label>
      <select [(ngModel)]="metodoPago">
        <option value="Efectivo">Efectivo</option>
        <option value="Yape">Yape</option>
        <option value="Tarjeta">Tarjeta</option>
      </select>
    </div>

    <button class="btn-finalizar"
            (click)="finalizarVenta()"
            [disabled]="errorDocumento || errorBuscar">
      âœ… Finalizar Venta
    </button>
  </div>
</div>
